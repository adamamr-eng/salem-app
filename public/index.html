<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salem - رعاية كبار السن</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Cairo', 'Tajawal', Arial, sans-serif; 
            background: linear-gradient(135deg, #D4A574 0%, #8B5A3C 100%);
            min-height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 10px; 
        }
        
        .app-container { 
            width: 100%; 
            max-width: 400px; 
            background: #FFF8F3; 
            border-radius: 25px; 
            box-shadow: 0 20px 60px rgba(139, 90, 60, 0.3), 0 0 80px rgba(212, 165, 116, 0.2); 
            overflow: hidden; 
            height: 700px; 
            display: flex; 
            flex-direction: column;
        }
        .header { 
            background: linear-gradient(135deg, #8B5A3C 0%, #6B4423 100%);
            color: #FFF8F3; 
            padding: 20px 15px; 
            text-align: center;
            position: relative;
        }
        .logo-container {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #FFF8F3 0%, #F5E6D8 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(139, 90, 60, 0.3);
            border: 3px solid rgba(212, 165, 116, 0.3);
        }

        .logo-text {
            font-size: 38px;
            font-weight: 900;
            background: linear-gradient(135deg, #8B5A3C 0%, #D4A574 50%, #6B4423 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header h1 { 
            font-size: 26px; 
            margin-bottom: 5px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            color: #FFF8F3;
        }
        .header .subtitle { 
            font-size: 13px; 
            opacity: 0.95;
            font-weight: 400;
            color: #D4A574;
        }
        .user-switch { 
            display: flex; 
            justify-content: center; 
            margin-top: 15px; 
            background: rgba(212, 165, 116, 0.2); 
            border-radius: 25px; 
            padding: 3px;
        }
        .user-switch button { 
            padding: 8px 18px; 
            border: none; 
            background: transparent; 
            color: rgba(255, 248, 243, 0.9); 
            cursor: pointer; 
            border-radius: 22px; 
            transition: all 0.3s ease; 
            font-size: 12px;
            font-weight: 600;
        }
        .user-switch button.active { 
            background: #FFF8F3; 
            color: #8B5A3C;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .patient-selector { 
            margin-top: 12px; 
            padding: 8px; 
            background: rgba(212, 165, 116, 0.2); 
            border-radius: 15px;
        }
        .patient-item { 
            background: rgba(255, 248, 243, 0.95); 
            color: #8B5A3C; 
            padding: 10px 14px; 
            border-radius: 12px; 
            margin-bottom: 6px; 
            cursor: pointer; 
            font-size: 13px; 
            font-weight: 600; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            transition: all 0.3s ease;
        }
        .patient-item:hover {
            transform: translateX(-5px);
            box-shadow: 0 3px 10px rgba(139, 90, 60, 0.2);
        }
        .patient-item.active { 
            background: #FFF8F3;
            box-shadow: 0 3px 12px rgba(139, 90, 60, 0.3);
        }
        .add-patient-btn { 
            background: rgba(255, 248, 243, 0.3); 
            color: #FFF8F3; 
            padding: 10px; 
            border-radius: 12px; 
            margin-top: 6px; 
            cursor: pointer; 
            font-size: 12px; 
            text-align: center; 
            border: 2px dashed rgba(255, 248, 243, 0.6);
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .add-patient-btn:hover {
            background: rgba(255, 248, 243, 0.4);
            border-color: #FFF8F3;
        }
        .content { 
            flex: 1; 
            overflow-y: auto; 
            padding: 15px; 
            background: #FFF8F3;
        }
        .content::-webkit-scrollbar { width: 5px; }
        .content::-webkit-scrollbar-thumb { 
            background: linear-gradient(135deg, #D4A574, #8B5A3C); 
            border-radius: 10px; 
        }
        .page { display: none; }
        .page.active { display: block; }
        .card { 
            background: white; 
            border-radius: 16px; 
            padding: 18px; 
            margin-bottom: 14px; 
            box-shadow: 0 4px 15px rgba(139, 90, 60, 0.08);
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 6px 20px rgba(139, 90, 60, 0.12);
            transform: translateY(-2px);
        }
        .btn { 
            padding: 12px 20px; 
            border: none; 
            border-radius: 12px; 
            font-size: 14px; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(139, 90, 60, 0.2);
        }
        .btn-primary { 
            background: linear-gradient(135deg, #D4A574, #8B5A3C); 
            color: white; 
        }
        .btn-primary:hover {
            box-shadow: 0 6px 20px rgba(139, 90, 60, 0.3);
            transform: translateY(-2px);
        }
        .btn-full { width: 100%; }
        .btn-small { 
            padding: 8px 14px; 
            font-size: 12px; 
        }
        .form-group { margin-bottom: 14px; }
        .form-label { 
            display: block; 
            margin-bottom: 6px; 
            color: #6B4423; 
            font-size: 12px; 
            font-weight: 600; 
        }
        .form-input, select.form-input { 
            width: 100%; 
            padding: 10px 12px; 
            border: 2px solid #F5E6D8; 
            border-radius: 10px; 
            font-size: 14px; 
            font-family: inherit;
            background: #FFFAF5;
            transition: all 0.3s ease;
        }
        .form-input:focus, select.form-input:focus { 
            outline: none; 
            border-color: #D4A574;
            background: white;
            box-shadow: 0 0 0 3px rgba(212, 165, 116, 0.1);
        }
        .medicine-card { 
            background: linear-gradient(135deg, #FFFAF5 0%, white 100%); 
            border-radius: 16px; 
            padding: 18px; 
            margin-bottom: 14px; 
            box-shadow: 0 4px 15px rgba(139, 90, 60, 0.1); 
            border-right: 4px solid #D4A574;
            transition: all 0.3s ease;
        }
        .medicine-card:hover {
            transform: translateX(-5px);
            box-shadow: 0 6px 20px rgba(139, 90, 60, 0.15);
        }
        [dir="ltr"] .medicine-card { 
            border-right: none; 
            border-left: 4px solid #D4A574; 
        }
        .medicine-time { 
            font-size: 20px; 
            color: #8B5A3C; 
            font-weight: 700; 
            margin-bottom: 8px; 
        }
        .medicine-name { 
            font-size: 16px; 
            margin-bottom: 5px; 
            color: #6B4423; 
            font-weight: 600; 
        }
        .medicine-dose { 
            color: #A0826B; 
            margin-bottom: 12px; 
            font-size: 13px; 
        }
        
        .activity-card { 
            background: white; 
            border-radius: 16px; 
            padding: 14px; 
            margin-bottom: 12px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            box-shadow: 0 4px 15px rgba(139, 90, 60, 0.08); 
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .activity-card:hover {
            transform: translateX(-5px);
            box-shadow: 0 6px 20px rgba(139, 90, 60, 0.15);
        }
        .activity-icon { 
            width: 50px; 
            height: 50px; 
            background: linear-gradient(135deg, #D4A574, #8B5A3C); 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 24px; 
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(139, 90, 60, 0.2);
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 12px; 
            margin-bottom: 16px; 
        }
        .stat-card { 
            background: white; 
            border-radius: 16px; 
            padding: 16px; 
            text-align: center; 
            box-shadow: 0 4px 15px rgba(139, 90, 60, 0.08);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(139, 90, 60, 0.12);
        }
        .stat-number { 
            font-size: 26px; 
            font-weight: 700; 
            background: linear-gradient(135deg, #D4A574, #8B5A3C);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .stat-label { 
            font-size: 11px; 
            color: #A0826B; 
            margin-top: 4px; 
        }
        .alert-card { 
            background: linear-gradient(135deg, #E74C3C, #C0392B); 
            color: white; 
            border-radius: 16px; 
            padding: 14px; 
            margin-bottom: 16px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.2);
        }
        .meal-section { margin-bottom: 16px; }
        .meal-header { 
            background: linear-gradient(135deg, #8B5A3C, #6B4423); 
            color: #FFF8F3; 
            padding: 10px 14px; 
            border-radius: 12px; 
            margin-bottom: 8px; 
            font-weight: 600; 
            font-size: 14px;
            box-shadow: 0 3px 10px rgba(139, 90, 60, 0.2);
        }
        .meal-item { 
            background: white; 
            padding: 12px; 
            border-radius: 12px; 
            margin-bottom: 8px; 
            box-shadow: 0 3px 12px rgba(139, 90, 60, 0.08); 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            transition: all 0.3s ease;
        }
        .meal-item:hover {
            transform: translateX(-3px);
            box-shadow: 0 4px 15px rgba(139, 90, 60, 0.12);
        }
        .appointment-card { 
            background: white; 
            border-radius: 16px; 
            padding: 14px; 
            margin-bottom: 12px; 
            box-shadow: 0 4px 15px rgba(139, 90, 60, 0.08); 
            border-right: 3px solid #D4A574;
            transition: all 0.3s ease;
        }
        .appointment-card:hover {
            transform: translateX(-5px);
            box-shadow: 0 6px 20px rgba(139, 90, 60, 0.12);
        }
        [dir="ltr"] .appointment-card { 
            border-right: none; 
            border-left: 3px solid #D4A574; 
        }
        .appointment-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 8px; 
        }
        .appointment-date { 
            background: linear-gradient(135deg, #D4A574, #8B5A3C); 
            color: white; 
            padding: 5px 12px; 
            border-radius: 20px; 
            font-size: 11px; 
            font-weight: 600; 
        }
        .vitals-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 12px; 
            margin-bottom: 16px; 
        }
        .vital-input-group { 
            background: white; 
            padding: 14px; 
            border-radius: 12px; 
            box-shadow: 0 3px 12px rgba(139, 90, 60, 0.08);
            transition: all 0.3s ease;
        }
        .vital-input-group:hover {
            box-shadow: 0 4px 15px rgba(139, 90, 60, 0.12);
        }
        .vital-input { 
            width: 100%; 
            padding: 8px; 
            border: 2px solid #F5E6D8; 
            border-radius: 8px; 
            font-size: 16px; 
            font-weight: 700; 
            text-align: center; 
            color: #6B4423; 
            background: #FFFAF5;
            transition: all 0.3s ease;
        }
        .vital-input:focus { 
            border-color: #D4A574; 
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(212, 165, 116, 0.1);
        }
        .vital-unit { 
            text-align: center; 
            color: #A0826B; 
            font-size: 10px; 
            margin-top: 4px; 
        }
        .history-list { 
            background: white; 
            border-radius: 16px; 
            padding: 14px; 
            margin-top: 16px; 
            box-shadow: 0 4px 15px rgba(139, 90, 60, 0.08); 
        }
        .history-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 10px 0; 
            border-bottom: 1px solid #F5E6D8; 
        }
        .history-item:last-child { border-bottom: none; }
        .time-inputs { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px; 
            margin-bottom: 14px; 
        }
        .time-slot { 
            padding: 10px; 
            background: #FFFAF5; 
            border-radius: 10px; 
            text-align: center; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            font-weight: 600; 
            font-size: 13px; 
            color: #6B4423;
            border: 2px solid transparent;
        }
        .time-slot:hover {
            background: #F5E6D8;
            transform: translateY(-2px);
        }
        .time-slot.selected { 
            background: linear-gradient(135deg, #D4A574, #8B5A3C); 
            color: white;
            box-shadow: 0 4px 12px rgba(139, 90, 60, 0.2);
        }
        .success-message { 
            background: linear-gradient(135deg, #27AE60, #229954); 
            color: white; 
            padding: 12px; 
            border-radius: 12px; 
            margin-bottom: 14px; 
            text-align: center; 
            font-weight: 600; 
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.2);
        }
        .bottom-nav { 
            background: white; 
            padding: 10px 0; 
            display: grid; 
            grid-template-columns: repeat(6, 1fr); 
            border-top: 1px solid #F5E6D8;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.05);
        }
        .nav-item { 
            text-align: center; 
            cursor: pointer; 
            padding: 6px 0;
            transition: all 0.3s ease;
        }
        .nav-item:hover {
            background: #FFFAF5;
        }
        .nav-icon { 
            font-size: 20px; 
            margin-bottom: 3px; 
        }
        .nav-label { 
            font-size: 10px; 
            color: #A0826B; 
            font-weight: 600; 
        }
        .nav-item.active .nav-label { 
            color: #8B5A3C; 
        }
        .nav-item.active .nav-icon {
            filter: drop-shadow(0 2px 4px rgba(139, 90, 60, 0.3));
        }
        .setting-item { 
            background: white; 
            padding: 14px; 
            border-radius: 12px; 
            margin-bottom: 10px; 
            box-shadow: 0 3px 12px rgba(139, 90, 60, 0.08); 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            transition: all 0.3s ease;
        }
        .setting-item:hover {
            box-shadow: 0 4px 15px rgba(139, 90, 60, 0.12);
        }
        .toggle-switch { 
            position: relative; 
            width: 48px; 
            height: 26px; 
        }
        .toggle-switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }
        .toggle-slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: #E0D0C0; 
            transition: 0.3s; 
            border-radius: 26px; 
        }
        .toggle-slider:before { 
            position: absolute; 
            content: ""; 
            height: 20px; 
            width: 20px; 
            left: 3px; 
            bottom: 3px; 
            background-color: white; 
            transition: 0.3s; 
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        input:checked + .toggle-slider { 
            background: linear-gradient(135deg, #D4A574, #8B5A3C); 
        }
        input:checked + .toggle-slider:before { 
            transform: translateX(22px); 
        }
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.6); 
            justify-content: center; 
            align-items: center; 
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        .modal.active { display: flex; }
        .modal-content { 
            background: white; 
            border-radius: 20px; 
            padding: 24px; 
            width: 90%; 
            max-width: 350px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        h2, h3 { 
            color: #6B4423; 
            margin-bottom: 12px; 
            font-size: 16px; 
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div class="logo-container">
                <div class="logo-text">سَليم</div>
            </div>
            <h1 id="appTitle">سَليم</h1>
            <p class="subtitle" id="appSubtitle">رعاية كبار السن بكل حب</p>
            <div class="user-switch">
                <button id="elderBtn" class="active" onclick="switchUserView('elder')">كبير السن</button>
                <button id="familyBtn" onclick="switchUserView('family')">أفراد العائلة</button>
            </div>
            <div id="patientSelector" class="patient-selector" style="display: none;">
                <div id="patientsList"></div>
                <div class="add-patient-btn" onclick="showAddPatientModal()">+ إضافة جد/جدة جديد</div>
            </div>
        </div>

        <div class="content">
            <div id="homePage-elder" class="page active">
                <div id="elderMedicinesList"></div>
                <h3 id="activitiesTitle">الأنشطة اليومية</h3>
                <div id="activitiesList"></div>
            </div>

            <div id="homePage-family" class="page">
                <div id="familyAlerts"></div>
                <div id="familyStats"></div>
                <div id="familySummary"></div>
            </div>

            <div id="medicinesPage" class="page">
                <div class="card">
                    <h3 id="addMedicineTitle">إضافة دواء جديد</h3>
                    <div class="form-group">
                        <label class="form-label" id="medNameLabel">اسم الدواء</label>
                        <input type="text" class="form-input" id="medName">
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="medDoseLabel">الجرعة</label>
                        <input type="text" class="form-input" id="medDose">
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="medTimesLabel">المواعيد</label>
                        <div class="time-inputs">
                            <div class="time-slot" onclick="toggleTime(this)">8 ص</div>
                            <div class="time-slot" onclick="toggleTime(this)">12 م</div>
                            <div class="time-slot" onclick="toggleTime(this)">2 م</div>
                            <div class="time-slot" onclick="toggleTime(this)">6 م</div>
                            <div class="time-slot" onclick="toggleTime(this)">8 م</div>
                            <div class="time-slot" onclick="toggleTime(this)">10 م</div>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-full" onclick="addMedicine()" id="addMedicineBtn">+ إضافة</button>
                </div>
                <div id="medicineSuccess" class="success-message" style="display: none;">✓ تم إضافة الدواء بنجاح</div>
                <h3 id="currentMedicinesTitle">الأدوية الحالية</h3>
                <div id="medicinesList"></div>
            </div>

            <div id="mealsPage" class="page">
                <div class="card">
                    <h3 id="addMealTitle">إضافة وجبة جديدة</h3>
                    <div class="form-group">
                        <label class="form-label" id="mealTypeLabel">نوع الوجبة</label>
                        <select class="form-input" id="mealType">
                            <option>الإفطار</option>
                            <option>الغداء</option>
                            <option>العشاء</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="mealNameLabel">اسم الوجبة</label>
                        <input type="text" class="form-input" id="mealName">
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="mealTimeLabel">الوقت</label>
                        <input type="time" class="form-input" id="mealTime">
                    </div>
                    <button class="btn btn-primary btn-full" onclick="addMeal()" id="addMealBtn">+ إضافة</button>
                </div>
                <div id="mealSuccess" class="success-message" style="display: none;">✓ تم إضافة الوجبة بنجاح</div>
                <div id="mealsDisplay"></div>
            </div>

            <div id="appointmentsPage" class="page">
                <div class="card">
                    <h3 id="addAppointmentTitle">إضافة موعد جديد</h3>
                    <div class="form-group">
                        <label class="form-label" id="doctorNameLabel">اسم الدكتور</label>
                        <input type="text" class="form-input" id="doctorName">
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="clinicNameLabel">العيادة</label>
                        <input type="text" class="form-input" id="clinicName">
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="appointmentDateLabel">التاريخ</label>
                        <input type="date" class="form-input" id="appointmentDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="appointmentTimeLabel">الوقت</label>
                        <input type="time" class="form-input" id="appointmentTime">
                    </div>
                    <button class="btn btn-primary btn-full" onclick="addAppointment()" id="addAppointmentBtn">+ إضافة</button>
                </div>
                <div id="appointmentSuccess" class="success-message" style="display: none;">✓ تم إضافة الموعد بنجاح</div>
                <h3 id="upcomingAppointmentsTitle">المواعيد القادمة</h3>
                <div id="appointmentsList"></div>
            </div>

            <div id="vitalsPage" class="page">
                <div class="card">
                    <h3 id="recordVitalsTitle">تسجيل القياسات</h3>
                    <div class="vitals-grid">
                        <div class="vital-input-group">
                            <label class="form-label" id="systolicLabel">ضغط عالي</label>
                            <input type="text" class="vital-input" placeholder="120" id="systolic" inputmode="numeric">
                            <div class="vital-unit">mmHg</div>
                        </div>
                        <div class="vital-input-group">
                            <label class="form-label" id="diastolicLabel">ضغط منخفض</label>
                            <input type="text" class="vital-input" placeholder="80" id="diastolic" inputmode="numeric">
                            <div class="vital-unit">mmHg</div>
                        </div>
                        <div class="vital-input-group">
                            <label class="form-label" id="glucoseLabel">السكر</label>
                            <input type="text" class="vital-input" placeholder="110" id="glucose" inputmode="numeric">
                            <div class="vital-unit">mg/dL</div>
                        </div>
                        <div class="vital-input-group">
                            <label class="form-label" id="heartRateLabel">النبض</label>
                            <input type="text" class="vital-input" placeholder="72" id="heartRate" inputmode="numeric">
                            <div class="vital-unit">bpm</div>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-full" onclick="saveVitals()" id="saveVitalsBtn">💾 حفظ</button>
                </div>
                <div id="vitalsSuccess" class="success-message" style="display: none;">✓ تم حفظ القياسات بنجاح</div>
                <div class="history-list">
                    <h3 style="font-size: 13px;" id="previousRecordsTitle">السجل السابق</h3>
                    <div id="vitalsHistoryList"></div>
                </div>
            </div>

            <div id="settingsPage" class="page">
                <div class="card">
                    <h3 id="generalSettingsTitle">الإعدادات العامة</h3>
                    <div class="setting-item">
                        <div>
                            <div style="font-weight: 700; font-size: 12px;" id="notificationsTitle">الإشعارات</div>
                            <div style="font-size: 10px; color: #A0826B;" id="notificationsDesc">تنبيهات الأدوية</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="notificationsToggle" checked onchange="saveSettings()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item" style="cursor: default;">
                        <div style="flex: 1;">
                            <div style="font-weight: 700; font-size: 12px; margin-bottom: 6px;" id="languageTitle">اللغة</div>
                            <select class="form-input" id="languageSelect" onchange="saveSettings()" style="margin: 0;">
                                <option value="ar">العربية 🇪🇬</option>
                                <option value="en">English 🇺🇸</option>
                                <option value="fr">Français 🇫🇷</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3 id="patientInfoTitle">معلومات المريض</h3>
                    <div class="form-group">
                        <label class="form-label" id="nameLabel">الاسم</label>
                        <input type="text" class="form-input" id="patientName">
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="ageLabel">العمر</label>
                        <input type="text" class="form-input" id="patientAge" inputmode="numeric">
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="phoneLabel">رقم الهاتف</label>
                        <input type="text" class="form-input" id="patientPhone" inputmode="tel">
                    </div>
                    <button class="btn btn-primary btn-full" onclick="savePatientInfo()" id="saveChangesBtn">💾 حفظ التغييرات</button>
                </div>
                <div class="card">
                    <h3 id="contactsTitle">جهات الاتصال</h3>
                    <div id="contactsList"></div>
                    <button class="btn btn-primary btn-full" style="margin-top: 8px;" onclick="showAddContactModal()" id="addContactBtn">+ إضافة</button>
                </div>
                <div class="card" style="background: #FFF0ED; border: 2px solid #D4A574;">
                    <h3 style="font-size: 13px; color: #8B5A3C;" id="emergencyTitle">⚠️ حالات الطوارئ</h3>
                    <p style="font-size: 11px; color: #6B4423; margin: 6px 0;" id="emergencyDesc">إرسال تنبيه فوري لجميع جهات الاتصال</p>
                    <button class="btn btn-full" style="background: #E74C3C; color: white; font-weight: 700;" onclick="sendEmergencyAlert()" id="emergencyBtn">🚨 طوارئ</button>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="navigateTo('home')">
                <div class="nav-icon">🏠</div>
                <div class="nav-label" id="navHome">الرئيسية</div>
            </div>
            <div class="nav-item" onclick="navigateTo('medicines')">
                <div class="nav-icon">💊</div>
                <div class="nav-label" id="navMedicines">الأدوية</div>
            </div>
            <div class="nav-item" onclick="navigateTo('meals')">
                <div class="nav-icon">🍽️</div>
                <div class="nav-label" id="navMeals">الوجبات</div>
            </div>
            <div class="nav-item" onclick="navigateTo('appointments')">
                <div class="nav-icon">📅</div>
                <div class="nav-label" id="navAppointments">المواعيد</div>
            </div>
            <div class="nav-item" onclick="navigateTo('vitals')">
                <div class="nav-icon">❤️</div>
                <div class="nav-label" id="navVitals">القياسات</div>
            </div>
            <div class="nav-item" onclick="navigateTo('settings')">
                <div class="nav-icon">⚙️</div>
                <div class="nav-label" id="navSettings">إعدادات</div>
            </div>
        </div>
    </div>

    <div id="addPatientModal" class="modal">
        <div class="modal-content">
            <h3 id="addPatientModalTitle">إضافة جد/جدة جديد</h3>
            <div class="form-group">
                <label class="form-label" id="newPatientNameLabel">الاسم</label>
                <input type="text" class="form-input" id="newPatientName">
            </div>
            <div class="form-group">
                <label class="form-label" id="newPatientAgeLabel">العمر</label>
                <input type="number" class="form-input" id="newPatientAge">
            </div>
            <div style="display: flex; gap: 8px;">
                <button class="btn btn-primary" style="flex: 1;" onclick="addNewPatient()" id="addPatientSubmitBtn">إضافة</button>
                <button class="btn" style="flex: 1; background: #E0D0C0;" onclick="closeAddPatientModal()" id="addPatientCancelBtn">إلغاء</button>
            </div>
        </div>
    </div>

    <div id="addContactModal" class="modal">
        <div class="modal-content">
            <h3 id="addContactModalTitle">إضافة جهة اتصال</h3>
            <div class="form-group">
                <label class="form-label" id="newContactNameLabel">الاسم</label>
                <input type="text" class="form-input" id="newContactName">
            </div>
            <div class="form-group">
                <label class="form-label" id="newContactPhoneLabel">رقم الهاتف</label>
                <input type="tel" class="form-input" id="newContactPhone">
            </div>
            <div style="display: flex; gap: 8px;">
                <button class="btn btn-primary" style="flex: 1;" onclick="addNewContact()" id="addContactSubmitBtn">إضافة</button>
                <button class="btn" style="flex: 1; background: #E0D0C0;" onclick="closeAddContactModal()" id="addContactCancelBtn">إلغاء</button>
            </div>
        </div>
    </div>

    <script>
       // if (!localStorage.getItem('salem_logged_in')) {
//   window.location.href = 'signin.html';
// }



        let currentView = 'elder';
        let currentPage = 'home';
        let currentPatientId = 0;
        let currentLang = 'ar';
        
        const T = {
            ar: {
                appTitle: 'سَليم', appSubtitle: 'رعاية كبار السن بكل حب', elder: 'كبير السن', family: 'أفراد العائلة',
                activities: 'الأنشطة اليومية', breathing: 'تمارين التنفس', memory: 'لعبة الذاكرة', walking: 'المشي الخفيف',
                minutes: 'دقائق', takeMed: '✓ تم أخذ الدواء', taken: '✓ تم الأخذ', alert: 'تنبيه!',
                didntTake: 'لم يأخذ دواء الضغط', compliance: 'التزام بالأدوية', completedAct: 'الأنشطة المكتملة',
                lastBP: 'آخر قياس ضغط', lastGlucose: 'آخر قياس سكر', summary: 'ملخص اليوم', tookMed: 'أخذ دواء السكر ✓',
                home: 'الرئيسية', medicines: 'الأدوية', meals: 'الوجبات', appointments: 'المواعيد', vitals: 'القياسات',
                settings: 'إعدادات', addMed: 'إضافة دواء جديد', medName: 'اسم الدواء', dose: 'الجرعة', times: 'المواعيد',
                add: 'إضافة', currentMeds: 'الأدوية الحالية', delete: 'حذف', addMeal: 'إضافة وجبة جديدة',
                mealType: 'نوع الوجبة', breakfast: 'الإفطار', lunch: 'الغداء', dinner: 'العشاء', mealName: 'اسم الوجبة',
                time: 'الوقت', addAppt: 'إضافة موعد جديد', doctor: 'اسم الدكتور', clinic: 'العيادة', date: 'التاريخ',
                upcoming: 'المواعيد القادمة', recordVitals: 'تسجيل القياسات', highBP: 'ضغط عالي', lowBP: 'ضغط منخفض',
                glucose: 'السكر', heartRate: 'النبض', save: '💾 حفظ', prevRecords: 'السجل السابق',
                generalSettings: 'الإعدادات العامة', notifications: 'الإشعارات', medAlerts: 'تنبيهات الأدوية',
                language: 'اللغة', patientInfo: 'معلومات المريض', name: 'الاسم', age: 'العمر', phone: 'رقم الهاتف',
                saveChanges: '💾 حفظ التغييرات', contacts: 'جهات الاتصال', emergency: '⚠️ حالات الطوارئ',
                emergencyDesc: 'إرسال تنبيه فوري لجميع جهات الاتصال', emergencyBtn: '🚨 طوارئ', cancel: 'إلغاء',
                addPatient: '+ إضافة جد/جدة جديد', years: 'سنة'
            },
            en: {
                appTitle: 'Salem', appSubtitle: 'Elderly Care with Love', elder: 'Elder', family: 'Family Members',
                activities: 'Daily Activities', breathing: 'Breathing Exercises', memory: 'Memory Game', walking: 'Light Walking',
                minutes: 'minutes', takeMed: '✓ Take Medicine', taken: '✓ Taken', alert: 'Alert!',
                didntTake: 'did not take blood pressure medicine', compliance: 'Medicine Compliance', completedAct: 'Completed Activities',
                lastBP: 'Last BP Reading', lastGlucose: 'Last Glucose', summary: 'Today\'s Summary', tookMed: 'Took diabetes medicine ✓',
                home: 'Home', medicines: 'Medicines', meals: 'Meals', appointments: 'Appointments', vitals: 'Vitals',
                settings: 'Settings', addMed: 'Add New Medicine', medName: 'Medicine Name', dose: 'Dose', times: 'Times',
                add: 'Add', currentMeds: 'Current Medicines', delete: 'Delete', addMeal: 'Add New Meal',
                mealType: 'Meal Type', breakfast: 'Breakfast', lunch: 'Lunch', dinner: 'Dinner', mealName: 'Meal Name',
                time: 'Time', addAppt: 'Add New Appointment', doctor: 'Doctor Name', clinic: 'Clinic', date: 'Date',
                upcoming: 'Upcoming Appointments', recordVitals: 'Record Vitals', highBP: 'Systolic', lowBP: 'Diastolic',
                glucose: 'Glucose', heartRate: 'Heart Rate', save: '💾 Save', prevRecords: 'Previous Records',
                generalSettings: 'General Settings', notifications: 'Notifications', medAlerts: 'Medicine Alerts',
                language: 'Language', patientInfo: 'Patient Information', name: 'Name', age: 'Age', phone: 'Phone Number',
                saveChanges: '💾 Save Changes', contacts: 'Contacts', emergency: '⚠️ Emergency',
                emergencyDesc: 'Send immediate alert to all contacts', emergencyBtn: '🚨 Emergency', cancel: 'Cancel',
                addPatient: '+ Add New Grandparent', years: 'years'
            },
            fr: {
                appTitle: 'Salem', appSubtitle: 'Soins aux personnes âgées avec amour', elder: 'Personne âgée', family: 'Membres de la famille',
                activities: 'Activités quotidiennes', breathing: 'Exercices de respiration', memory: 'Jeu de mémoire', walking: 'Marche légère',
                minutes: 'minutes', takeMed: '✓ Prendre le médicament', taken: '✓ Pris', alert: 'Alerte!',
                didntTake: 'n\'a pas pris le médicament pour la tension', compliance: 'Conformité médicamenteuse', completedAct: 'Activités terminées',
                lastBP: 'Dernière TA', lastGlucose: 'Dernière glycémie', summary: 'Résumé d\'aujourd\'hui', tookMed: 'A pris le médicament ✓',
                home: 'Accueil', medicines: 'Médicaments', meals: 'Repas', appointments: 'Rendez-vous', vitals: 'Signes vitaux',
                settings: 'Paramètres', addMed: 'Ajouter un médicament', medName: 'Nom du médicament', dose: 'Dose', times: 'Horaires',
                add: 'Ajouter', currentMeds: 'Médicaments actuels', delete: 'Supprimer', addMeal: 'Ajouter un repas',
                mealType: 'Type de repas', breakfast: 'Petit-déjeuner', lunch: 'Déjeuner', dinner: 'Dîner', mealName: 'Nom du repas',
                time: 'Heure', addAppt: 'Ajouter un rendez-vous', doctor: 'Nom du médecin', clinic: 'Clinique', date: 'Date',
                upcoming: 'Rendez-vous à venir', recordVitals: 'Enregistrer les signes', highBP: 'Systolique', lowBP: 'Diastolique',
                glucose: 'Glucose', heartRate: 'Fréquence cardiaque', save: '💾 Sauvegarder', prevRecords: 'Enregistrements précédents',
                generalSettings: 'Paramètres généraux', notifications: 'Notifications', medAlerts: 'Alertes médicamenteuses',
                language: 'Langue', patientInfo: 'Informations patient', name: 'Nom', age: 'Âge', phone: 'Numéro de téléphone',
                saveChanges: '💾 Sauvegarder', contacts: 'Contacts', emergency: '⚠️ Urgence',
                emergencyDesc: 'Envoyer une alerte à tous les contacts', emergencyBtn: '🚨 Urgence', cancel: 'Annuler',
                addPatient: '+ Ajouter un grand-parent', years: 'ans'
            }
        };
        
        let patients = [{
            id: 0, name: 'جدي محمد', age: 72, phone: '01234567890', medicines: [], meals: [], appointments: [],
            vitalsHistory: [], activities: [], contacts: [
                { name: 'الابن - أحمد', phone: '01111111111' },
                { name: 'الحفيدة - فاطمة', phone: '01222222222' }
            ], settings: { notifications: true, language: 'ar' }
        }];

        function t(k) { return T[currentLang][k] || k; }
        
        function updateLang(lang) {
            currentLang = lang;
            document.documentElement.setAttribute('lang', lang);
            document.documentElement.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');
            document.getElementById('appTitle').textContent = t('appTitle');
            document.getElementById('appSubtitle').textContent = t('appSubtitle');
            document.getElementById('elderBtn').textContent = t('elder');
            document.getElementById('familyBtn').textContent = t('family');
            document.querySelector('.add-patient-btn').textContent = t('addPatient');
            document.getElementById('activitiesTitle').textContent = t('activities');
            document.getElementById('navHome').textContent = t('home');
            document.getElementById('navMedicines').textContent = t('medicines');
            document.getElementById('navMeals').textContent = t('meals');
            document.getElementById('navAppointments').textContent = t('appointments');
            document.getElementById('navVitals').textContent = t('vitals');
            document.getElementById('navSettings').textContent = t('settings');
            document.getElementById('addMedicineTitle').textContent = t('addMed');
            document.getElementById('medNameLabel').textContent = t('medName');
            document.getElementById('medDoseLabel').textContent = t('dose');
            document.getElementById('medTimesLabel').textContent = t('times');
            document.getElementById('addMedicineBtn').textContent = '+ ' + t('add');
            document.getElementById('currentMedicinesTitle').textContent = t('currentMeds');
            document.getElementById('addMealTitle').textContent = t('addMeal');
            document.getElementById('mealTypeLabel').textContent = t('mealType');
            document.getElementById('mealNameLabel').textContent = t('mealName');
            document.getElementById('mealTimeLabel').textContent = t('time');
            document.getElementById('addMealBtn').textContent = '+ ' + t('add');
            document.getElementById('mealType').innerHTML = `<option>${t('breakfast')}</option><option>${t('lunch')}</option><option>${t('dinner')}</option>`;
            document.getElementById('addAppointmentTitle').textContent = t('addAppt');
            document.getElementById('doctorNameLabel').textContent = t('doctor');
            document.getElementById('clinicNameLabel').textContent = t('clinic');
            document.getElementById('appointmentDateLabel').textContent = t('date');
            document.getElementById('appointmentTimeLabel').textContent = t('time');
            document.getElementById('addAppointmentBtn').textContent = '+ ' + t('add');
            document.getElementById('upcomingAppointmentsTitle').textContent = t('upcoming');
            document.getElementById('recordVitalsTitle').textContent = t('recordVitals');
            document.getElementById('systolicLabel').textContent = t('highBP');
            document.getElementById('diastolicLabel').textContent = t('lowBP');
            document.getElementById('glucoseLabel').textContent = t('glucose');
            document.getElementById('heartRateLabel').textContent = t('heartRate');
            document.getElementById('saveVitalsBtn').textContent = t('save');
            document.getElementById('previousRecordsTitle').textContent = t('prevRecords');
            document.getElementById('generalSettingsTitle').textContent = t('generalSettings');
            document.getElementById('notificationsTitle').textContent = t('notifications');
            document.getElementById('notificationsDesc').textContent = t('medAlerts');
            document.getElementById('languageTitle').textContent = t('language');
            document.getElementById('patientInfoTitle').textContent = t('patientInfo');
            document.getElementById('nameLabel').textContent = t('name');
            document.getElementById('ageLabel').textContent = t('age');
            document.getElementById('phoneLabel').textContent = t('phone');
            document.getElementById('saveChangesBtn').textContent = t('saveChanges');
            document.getElementById('contactsTitle').textContent = t('contacts');
            document.getElementById('addContactBtn').textContent = '+ ' + t('add');
            document.getElementById('emergencyTitle').textContent = t('emergency');
            document.getElementById('emergencyDesc').textContent = t('emergencyDesc');
            document.getElementById('emergencyBtn').textContent = t('emergencyBtn');
            document.getElementById('addPatientModalTitle').textContent = t('addPatient');
            document.getElementById('newPatientNameLabel').textContent = t('name');
            document.getElementById('newPatientAgeLabel').textContent = t('age');
            document.getElementById('addPatientSubmitBtn').textContent = t('add');
            document.getElementById('addPatientCancelBtn').textContent = t('cancel');
            document.getElementById('addContactModalTitle').textContent = t('contacts');
            document.getElementById('newContactNameLabel').textContent = t('name');
            document.getElementById('newContactPhoneLabel').textContent = t('phone');
            document.getElementById('addContactSubmitBtn').textContent = t('add');
            document.getElementById('addContactCancelBtn').textContent = t('cancel');
            
            if (currentView === 'elder') displayElderMedicines();
            if (currentView === 'family') displayFamilyView();
            if (currentPage === 'medicines') displayMedicines();
            if (currentPage === 'meals') displayMeals();
            if (currentPage === 'appointments') displayAppointments();
            if (currentPage === 'vitals') displayVitalsHistory();
        }

        function getCurrentPatient() { return patients.find(p => p.id === currentPatientId) || patients[0]; }

        function switchUserView(view) {
            currentView = view;
            document.getElementById('elderBtn').classList.toggle('active', view === 'elder');
            document.getElementById('familyBtn').classList.toggle('active', view === 'family');
            document.getElementById('patientSelector').style.display = view === 'family' ? 'block' : 'none';
            if (view === 'family') displayPatientsList();
            document.getElementById('homePage-elder').classList.toggle('active', view === 'elder');
            document.getElementById('homePage-family').classList.toggle('active', view === 'family');
            view === 'family' ? displayFamilyView() : displayElderMedicines();
        }

        function displayPatientsList() {
            const list = document.getElementById('patientsList');
            list.innerHTML = '';
            patients.forEach(patient => {
                const item = document.createElement('div');
                item.className = 'patient-item' + (patient.id === currentPatientId ? ' active' : '');
                item.innerHTML = `<span>${patient.name} (${patient.age} ${t('years')})</span><span>👤</span>`;
                item.onclick = () => selectPatient(patient.id);
                list.appendChild(item);
            });
        }

        function selectPatient(id) {
            currentPatientId = id;
            const patient = getCurrentPatient();
            currentLang = patient.settings.language;
            document.getElementById('languageSelect').value = currentLang;
            updateLang(currentLang);
            displayPatientsList();
            displayFamilyView();
            loadPatientSettings();
        }

        function loadPatientSettings() {
            const patient = getCurrentPatient();
            document.getElementById('patientName').value = patient.name;
            document.getElementById('patientAge').value = patient.age;
            document.getElementById('patientPhone').value = patient.phone;
            document.getElementById('notificationsToggle').checked = patient.settings.notifications;
            document.getElementById('languageSelect').value = patient.settings.language;
        }

        function displayFamilyView() {
            const patient = getCurrentPatient();
            document.getElementById('familyAlerts').innerHTML = `
                <div class="alert-card"><div><strong style="font-size: 13px;">${t('alert')}</strong><br>
                <span style="font-size: 12px;">${patient.name} ${t('didntTake')}</span></div><div style="font-size: 22px;">⚠️</div></div>`;
            const activitiesDone = patient.activities.filter(a => a.done).length;
            document.getElementById('familyStats').innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-number">85%</div><div class="stat-label">${t('compliance')}</div></div>
                    <div class="stat-card"><div class="stat-number">${activitiesDone}/3</div><div class="stat-label">${t('completedAct')}</div></div>
                    <div class="stat-card"><div class="stat-number">${patient.vitalsHistory.length > 0 ? patient.vitalsHistory[0].systolic + '/' + patient.vitalsHistory[0].diastolic : '120/80'}</div><div class="stat-label">${t('lastBP')}</div></div>
                    <div class="stat-card"><div class="stat-number">${patient.vitalsHistory.length > 0 ? patient.vitalsHistory[0].glucose : '110'}</div><div class="stat-label">${t('lastGlucose')}</div></div>
                </div>`;
            document.getElementById('familySummary').innerHTML = `
                <div class="card"><h3>${t('summary')} - ${patient.name}</h3>
                <div style="padding: 8px; border-${currentLang === 'ar' ? 'right' : 'left'}: 3px solid #27AE60; margin: 8px 0; background: #E8F8F5; border-radius: 6px;">
                    <div style="font-size: 10px; color: #6B4423;">7:00 ${currentLang === 'ar' ? 'ص' : 'AM'}</div>
                    <div style="font-size: 12px; font-weight: 600; color: #27AE60;">${t('tookMed')}</div></div>
                ${patient.activities.map(a => `<div style="padding: 8px; border-${currentLang === 'ar' ? 'right' : 'left'}: 3px solid ${a.done ? '#27AE60' : '#F39C12'}; margin: 8px 0; background: ${a.done ? '#E8F8F5' : '#FEF9E7'}; border-radius: 6px;">
                    <div style="font-size: 10px; color: #6B4423;">${a.time}</div><div style="font-size: 12px; font-weight: 600; color: ${a.done ? '#27AE60' : '#F39C12'};">${a.name} ${a.done ? '✓' : '⏳'}</div></div>`).join('')}
                </div>`;
        }

        function displayElderMedicines() {
            const patient = getCurrentPatient();
            const html = patient.medicines.slice(0, 2).map(med => `
                <div class="medicine-card"><div class="medicine-time">⏰ ${med.times[0]}</div>
                <div class="medicine-name">💊 ${med.name}</div><div class="medicine-dose">${med.dose}</div>
                <button class="btn btn-primary btn-full" onclick="takeMedicine(this)">${t('takeMed')}</button></div>`).join('');
            document.getElementById('elderMedicinesList').innerHTML = html;
            document.getElementById('activitiesList').innerHTML = `
                <div class="activity-card" onclick="markActivityDone('breathing')"><div>
                    <div style="font-weight: 600; font-size: 13px;">${t('breathing')}</div>
                    <div style="font-size: 11px; color: #A0826B;">5 ${t('minutes')}</div></div><div class="activity-icon">🫁</div></div>
                <div class="activity-card" onclick="markActivityDone('memory')"><div>
                    <div style="font-weight: 600; font-size: 13px;">${t('memory')}</div>
                    <div style="font-size: 11px; color: #A0826B;">10 ${t('minutes')}</div></div><div class="activity-icon">🧠</div></div>
                <div class="activity-card" onclick="markActivityDone('walking')"><div>
                    <div style="font-weight: 600; font-size: 13px;">${t('walking')}</div>
                    <div style="font-size: 11px; color: #A0826B;">15 ${t('minutes')}</div></div><div class="activity-icon">🚶</div></div>`;
        }

        function navigateTo(page) {
            currentPage = page;
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if (page === 'home') {
                if (currentView === 'elder') { document.getElementById('homePage-elder').classList.add('active'); displayElderMedicines(); }
                else { document.getElementById('homePage-family').classList.add('active'); displayFamilyView(); }
            } else if (page === 'medicines') { document.getElementById('medicinesPage').classList.add('active'); displayMedicines(); }
            else if (page === 'meals') { document.getElementById('mealsPage').classList.add('active'); displayMeals(); }
            else if (page === 'appointments') { document.getElementById('appointmentsPage').classList.add('active'); displayAppointments(); }
            else if (page === 'vitals') { document.getElementById('vitalsPage').classList.add('active'); displayVitalsHistory(); }
            else if (page === 'settings') { document.getElementById('settingsPage').classList.add('active'); loadPatientSettings(); displayContacts(); }
            document.querySelectorAll('.nav-item').forEach(item => { if (item.onclick.toString().includes(page)) item.classList.add('active'); });
        }

        function takeMedicine(btn) { btn.style.background = '#27AE60'; btn.textContent = t('taken'); btn.disabled = true; }

        function markActivityDone(type) {
            const patient = getCurrentPatient();
            patient.activities.push({ type: type, name: t(type), time: new Date().toLocaleTimeString(currentLang === 'ar' ? 'ar-EG' : currentLang === 'fr' ? 'fr-FR' : 'en-US', { hour: '2-digit', minute: '2-digit' }), done: true });
            alert(currentLang === 'ar' ? '✓ تم تسجيل النشاط بنجاح!' : currentLang === 'fr' ? '✓ Activité enregistrée!' : '✓ Activity recorded!');
        }

        function toggleTime(el) { el.classList.toggle('selected'); }

        function addMedicine() {
            const patient = getCurrentPatient();
            const name = document.getElementById('medName').value;
            const dose = document.getElementById('medDose').value;
            const times = [];
            document.querySelectorAll('.time-slot.selected').forEach(slot => times.push(slot.textContent));
            if (name && dose && times.length > 0) {
                patient.medicines.push({ name, dose, times });
                document.getElementById('medicineSuccess').style.display = 'block';
                setTimeout(() => document.getElementById('medicineSuccess').style.display = 'none', 3000);
                document.getElementById('medName').value = '';
                document.getElementById('medDose').value = '';
                document.querySelectorAll('.time-slot').forEach(t => t.classList.remove('selected'));
                displayMedicines();
                displayElderMedicines();
            } else alert(currentLang === 'ar' ? 'من فضلك أدخل اسم الدواء والجرعة واختر المواعيد' : currentLang === 'fr' ? 'Veuillez entrer le médicament' : 'Please enter medicine details');
        }

        function displayMedicines() {
            const patient = getCurrentPatient();
            document.getElementById('medicinesList').innerHTML = patient.medicines.map((med, i) => `
                <div class="medicine-card"><div style="display: flex; justify-content: space-between; align-items: center;">
                <div><div class="medicine-name">💊 ${med.name}</div><div class="medicine-dose">${med.dose} - ${med.times.join(', ')}</div></div>
                <button class="btn btn-small" style="background: #E74C3C; color: white;" onclick="deleteMedicine(${i})">${t('delete')}</button></div></div>`).join('');
        }

        function deleteMedicine(i) {
            if (confirm(currentLang === 'ar' ? 'هل أنت متأكد من حذف هذا الدواء؟' : currentLang === 'fr' ? 'Supprimer?' : 'Delete medicine?')) {
                getCurrentPatient().medicines.splice(i, 1);
                displayMedicines();
                displayElderMedicines();
            }
        }

        function addMeal() {
            const patient = getCurrentPatient();
            const type = document.getElementById('mealType').value;
            const name = document.getElementById('mealName').value;
            const time = document.getElementById('mealTime').value;
            if (name && time) {
                patient.meals.push({ type, name, time });
                document.getElementById('mealSuccess').style.display = 'block';
                setTimeout(() => document.getElementById('mealSuccess').style.display = 'none', 3000);
                document.getElementById('mealName').value = '';
                document.getElementById('mealTime').value = '';
                displayMeals();
            } else alert(currentLang === 'ar' ? 'من فضلك أدخل اسم الوجبة والوقت' : currentLang === 'fr' ? 'Entrez les détails' : 'Enter meal details');
        }

        function displayMeals() {
            const patient = getCurrentPatient();
            const mealTypes = { [t('breakfast')]: { icon: '🌅', emoji: '🥛' }, [t('lunch')]: { icon: '☀️', emoji: '🍗' }, [t('dinner')]: { icon: '🌆', emoji: '🍲' } };
            let html = '';
            Object.keys(mealTypes).forEach(type => {
                const meals = patient.meals.filter(m => m.type === type);
                if (meals.length > 0) html += `<div class="meal-section"><div class="meal-header">${mealTypes[type].icon} ${type}</div>
                    ${meals.map(meal => `<div class="meal-item"><div><div style="font-size: 12px; font-weight: 600;">${meal.name}</div>
                    <div style="font-size: 10px; color: #A0826B;">${meal.time}</div></div><span>${mealTypes[type].emoji}</span></div>`).join('')}</div>`;
            });
            document.getElementById('mealsDisplay').innerHTML = html;
        }

        function addAppointment() {
            const patient = getCurrentPatient();
            const doctor = document.getElementById('doctorName').value;
            const clinic = document.getElementById('clinicName').value;
            const date = document.getElementById('appointmentDate').value;
            const time = document.getElementById('appointmentTime').value;
            if (doctor && clinic && date && time) {
                patient.appointments.push({ doctor, clinic, date, time });
                document.getElementById('appointmentSuccess').style.display = 'block';
                setTimeout(() => document.getElementById('appointmentSuccess').style.display = 'none', 3000);
                document.getElementById('doctorName').value = '';
                document.getElementById('clinicName').value = '';
                document.getElementById('appointmentDate').value = '';
                document.getElementById('appointmentTime').value = '';
                displayAppointments();
            } else alert(currentLang === 'ar' ? 'من فضلك أكمل جميع البيانات' : currentLang === 'fr' ? 'Remplissez tout' : 'Complete all fields');
        }

        function displayAppointments() {
            const patient = getCurrentPatient();
            document.getElementById('appointmentsList').innerHTML = patient.appointments.map(apt => {
                const dateStr = new Date(apt.date).toLocaleDateString(currentLang === 'ar' ? 'ar-EG' : currentLang === 'fr' ? 'fr-FR' : 'en-US', { day: 'numeric', month: 'long' });
                return `<div class="appointment-card"><div class="appointment-header">
                    <div style="font-weight: 700; font-size: 13px;">${apt.doctor}</div>
                    <div class="appointment-date">${dateStr}</div></div>
                    <div style="font-size: 11px; color: #A0826B;">${apt.clinic}</div>
                    <div style="color: #D4A574; font-weight: 600; font-size: 12px; margin-top: 3px;">⏰ ${apt.time}</div></div>`;
            }).join('');
        }

        function saveVitals() {
            const patient = getCurrentPatient();
            const systolic = document.getElementById('systolic').value;
            const diastolic = document.getElementById('diastolic').value;
            const glucose = document.getElementById('glucose').value;
            const heartRate = document.getElementById('heartRate').value;
            if (systolic && diastolic && glucose && heartRate) {
                const dateStr = new Date().toLocaleDateString(currentLang === 'ar' ? 'ar-EG' : currentLang === 'fr' ? 'fr-FR' : 'en-US', { day: 'numeric', month: 'long' });
                patient.vitalsHistory.unshift({ systolic, diastolic, glucose, heartRate, date: dateStr });
                document.getElementById('vitalsSuccess').style.display = 'block';
                setTimeout(() => document.getElementById('vitalsSuccess').style.display = 'none', 3000);
                document.getElementById('systolic').value = '';
                document.getElementById('diastolic').value = '';
                document.getElementById('glucose').value = '';
                document.getElementById('heartRate').value = '';
                displayVitalsHistory();
            } else alert(currentLang === 'ar' ? 'من فضلك أدخل جميع القياسات' : currentLang === 'fr' ? 'Entrez tout' : 'Enter all vitals');
        }

        function displayVitalsHistory() {
            const patient = getCurrentPatient();
            const bpLabel = currentLang === 'ar' ? 'ضغط' : currentLang === 'fr' ? 'TA' : 'BP';
            document.getElementById('vitalsHistoryList').innerHTML = patient.vitalsHistory.slice(0, 5).map(vital => `
                <div class="history-item"><div><div style="font-weight: 700; font-size: 13px;">${vital.systolic}/${vital.diastolic}</div>
                <div style="font-size: 9px; color: #A0826B;">${bpLabel}</div></div>
                <div style="text-align: ${currentLang === 'ar' ? 'left' : 'right'};"><div style="font-weight: 700; color: #D4A574; font-size: 13px;">${vital.glucose}</div>
                <div style="font-size: 9px; color: #A0826B;">${vital.date}</div></div></div>`).join('');
        }

        function saveSettings() {
            const patient = getCurrentPatient();
            patient.settings.notifications = document.getElementById('notificationsToggle').checked;
            const newLang = document.getElementById('languageSelect').value;
            patient.settings.language = newLang;
            updateLang(newLang);
            alert(currentLang === 'ar' ? '✓ تم حفظ الإعدادات' : currentLang === 'fr' ? '✓ Paramètres sauvegardés' : '✓ Settings saved');
        }

        function savePatientInfo() {
            const patient = getCurrentPatient();
            patient.name = document.getElementById('patientName').value;
            patient.age = document.getElementById('patientAge').value;
            patient.phone = document.getElementById('patientPhone').value;
            displayPatientsList();
            alert(currentLang === 'ar' ? '✓ تم حفظ المعلومات' : currentLang === 'fr' ? '✓ Informations sauvegardées' : '✓ Information saved');
        }

        function displayContacts() {
            const patient = getCurrentPatient();
            document.getElementById('contactsList').innerHTML = patient.contacts.map((contact, i) => `
                <div class="setting-item"><div><div style="font-weight: 700; font-size: 12px;">${contact.name}</div>
                <div style="font-size: 10px; color: #A0826B;">${contact.phone}</div></div>
                <div style="cursor: pointer;" onclick="deleteContact(${i})">🗑️</div></div>`).join('');
        }

        function deleteContact(i) {
            if (confirm(currentLang === 'ar' ? 'هل تريد حذف جهة الاتصال؟' : currentLang === 'fr' ? 'Supprimer?' : 'Delete contact?')) {
                getCurrentPatient().contacts.splice(i, 1);
                displayContacts();
            }
        }

        function showAddPatientModal() { document.getElementById('addPatientModal').classList.add('active'); }
        function closeAddPatientModal() { document.getElementById('addPatientModal').classList.remove('active'); }

        function addNewPatient() {
            const name = document.getElementById('newPatientName').value;
            const age = document.getElementById('newPatientAge').value;
            if (name && age) {
                patients.push({ id: patients.length, name, age, phone: '', medicines: [], meals: [], appointments: [], vitalsHistory: [], activities: [], contacts: [], settings: { notifications: true, language: currentLang } });
                document.getElementById('newPatientName').value = '';
                document.getElementById('newPatientAge').value = '';
                closeAddPatientModal();
                displayPatientsList();
                alert(currentLang === 'ar' ? '✓ تم إضافة المريض بنجاح' : currentLang === 'fr' ? '✓ Patient ajouté' : '✓ Patient added');
            } else alert(currentLang === 'ar' ? 'من فضلك أدخل الاسم والعمر' : currentLang === 'fr' ? 'Entrez le nom et l\'âge' : 'Enter name and age');
        }

        function showAddContactModal() { document.getElementById('addContactModal').classList.add('active'); }
        function closeAddContactModal() { document.getElementById('addContactModal').classList.remove('active'); }

        function addNewContact() {
            const patient = getCurrentPatient();
            const name = document.getElementById('newContactName').value;
            const phone = document.getElementById('newContactPhone').value;
            if (name && phone) {
                patient.contacts.push({ name, phone });
                document.getElementById('newContactName').value = '';
                document.getElementById('newContactPhone').value = '';
                closeAddContactModal();
                displayContacts();
                alert(currentLang === 'ar' ? '✓ تم إضافة جهة الاتصال' : currentLang === 'fr' ? '✓ Contact ajouté' : '✓ Contact added');
            } else alert(currentLang === 'ar' ? 'من فضلك أدخل الاسم ورقم الهاتف' : currentLang === 'fr' ? 'Entrez les détails' : 'Enter contact details');
        }

        function sendEmergencyAlert() {
            const patient = getCurrentPatient();
            if (confirm(currentLang === 'ar' ? 'هل تريد إرسال تنبيه طوارئ لجميع جهات الاتصال؟' : currentLang === 'fr' ? 'Envoyer une alerte d\'urgence?' : 'Send emergency alert?')) {
                alert(currentLang === 'ar' ? `🚨 تم إرسال تنبيه طوارئ لـ ${patient.contacts.length} جهة اتصال` : currentLang === 'fr' ? `🚨 Alerte envoyée à ${patient.contacts.length} contacts` : `🚨 Alert sent to ${patient.contacts.length} contacts`);
            }
        }
        function handleLogout() {
            if (confirm(currentLang === 'ar' ? 'هل تريد تسجيل الخروج؟' : currentLang === 'fr' ? 'Déconnexion?' : 'Logout?')) {
                localStorage.removeItem('salem_logged_in');
                localStorage.removeItem('salem_current_user');
                window.location.href = 'signin.html';
            }
        }

        const patient = getCurrentPatient();
        currentLang = patient.settings.language;
        updateLang(currentLang);
        displayElderMedicines();
        // أول ما التطبيق يفتح، يوجّه المستخدم لصفحة تسجيل الدخول
  window.onload = function() {
    // تأكد إن صفحة sign-in.html موجودة في مجلد public
    window.location.href = "/signin.html";
  }
    </script>
</body>
</html>